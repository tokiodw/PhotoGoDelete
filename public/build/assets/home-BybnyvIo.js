import{a as i}from"./axios-DsPaXkF5.js";import{M as m}from"./bootstrap.esm-D_59DZ1Y.js";import{C as n,N as a}from"./app-PF3Kj-JA.js";class E{constructor(t,e,s,r,l,o,d,p,u,c,h){this.modalEl=document.getElementById(t),this.nameInputEl=document.getElementById(e),this.fileInputEl=document.getElementById(r),this.nameInputFeedbackEl=document.getElementById(s),this.alertBoxEl=document.getElementById(o),this.fileInputFeedbackEl=document.getElementById(l),this.uploadButtonEl=document.getElementById(d),this.cancelButtonEl=document.getElementById(p),this.progressWrapperEl=document.getElementById(u),this.progressBarEl=document.getElementById(c),this.progressTextEl=document.getElementById(h),this.init()}init(){this.setupUploadButton(),this.setupCloseModal()}setupUploadButton(){this.uploadButtonEl.addEventListener("click",t=>{t.preventDefault(),this.uploadFile()})}closeModal(){m.getOrCreateInstance(this.modalEl).hide()}resetModal(){this.clearInput(),this.resetProgress(),this.enabledUploadButton()}setupCloseModal(){this.cancelButtonEl.addEventListener("click",()=>{this.cancelUpload()})}clearInput(){this.nameInputEl.value="",this.nameInputEl.classList.remove("is-valid","is-invalid"),this.nameInputFeedbackEl.innerText="",this.fileInputEl.value="",this.fileInputEl.classList.remove("is-valid","is-invalid"),this.fileInputFeedbackEl.innerText=""}uploadFile(){this.disabledUploadButton();const t=i.CancelToken.source(),e=this.nameInputEl.value.trim(),s=this.fileInputEl.files[0];if(!this.isInputValid(e,s)){this.enabledUploadButton();return}const l=new FormData;l.append("photoGroupName",e),l.append("zipFile",s),console.log("アップロード開始"),i.post("/",l,{headers:{"Content-Type":"multipart/form-data"},cancelToken:t.token,onUploadProgress:o=>this.updateProgress(o)}).then(()=>this.handleUploadSuccess()).catch(o=>{i.isCancel(o)?this.handleUploadCancel():this.handleUploadError()}),this.cancelUpload=()=>{t.cancel("アップロードが中断されました。"),this.cancelUpload=()=>{}}}disabledUploadButton(){this.uploadButtonEl.classList.remove("btn-primary"),this.uploadButtonEl.classList.add("btn-secondary"),this.uploadButtonEl.setAttribute("disabled","");const t=this.uploadButtonEl.querySelector("#uploadButtonBefore"),e=this.uploadButtonEl.querySelector("#uploadButtonAfter");t.style.display="none",e.removeAttribute("style")}enabledUploadButton(){this.uploadButtonEl.classList.remove("btn-secondary"),this.uploadButtonEl.classList.add("btn-primary"),this.uploadButtonEl.removeAttribute("disabled");const t=this.uploadButtonEl.querySelector("#uploadButtonBefore"),e=this.uploadButtonEl.querySelector("#uploadButtonAfter");t.removeAttribute("style"),e.style.display="none"}isInputValid(t,e){let s=!0;return t?(this.nameInputEl.classList.add("is-valid"),this.nameInputEl.classList.remove("is-invalid"),this.nameInputFeedbackEl.innerText=""):(s=!1,this.nameInputEl.classList.add("is-invalid"),this.nameInputEl.classList.remove("is-valid"),this.nameInputFeedbackEl.innerText="写真グループ名を入力してください。",console.warn("写真グループ名を入力してください。")),e?(this.fileInputEl.classList.add("is-valid"),this.fileInputEl.classList.remove("is-invalid"),this.fileInputFeedbackEl.innerText=""):(s=!1,this.fileInputEl.classList.add("is-invalid"),this.fileInputEl.classList.remove("is-valid"),this.fileInputFeedbackEl.innerText="zipファイルを選択してください。",console.warn("zipファイルを選択してください。")),s}updateProgress(t){if(t.lengthComputable){const e=Math.round(t.loaded/t.total*100);this.progressWrapperEl.removeAttribute("style"),this.progressWrapperEl.setAttribute("aria-valuenow",`${e}`),this.progressBarEl.style.width=`${e}%`,this.progressBarEl.innerText=`${e}%`}}resetProgress(){this.progressWrapperEl.style.display="none",this.progressWrapperEl.setAttribute("aria-valuenow","0"),this.progressBarEl.style.width="0",this.progressBarEl.innerText="",console.log("プログレスバーのリセット完了")}handleUploadSuccess(){this.closeModal(),this.resetModal(),this.showSuccessNotification()}handleUploadCancel(){this.resetModal(),this.showCancelNotification()}handleUploadError(){this.closeModal(),this.resetModal(),this.showErrorNotification()}showSuccessNotification(){const t=n.get(),e="アップロードが完了しました。",s=a.Success;t.display(e,s)}showCancelNotification(){const t=n.get(),e="アップロードが中止されました。",s=a.Warning;t.display(e,s)}showErrorNotification(){const t=n.get(),e="アップロードに失敗しました。",s=a.Error;t.display(e,s)}}document.addEventListener("DOMContentLoaded",()=>{new E("uploadModal","nameInput","nameInputFeedback","fileInput","fileInputFeedback","alertBox","uploadButton","cancelButton","progressWrapper","progressBar","progressText")});
